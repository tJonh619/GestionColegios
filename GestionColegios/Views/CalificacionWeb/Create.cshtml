@model GestionColegios.ViewModels.VMCalificaciones

@{
    ViewBag.Title = "Registrar Notas";
}

<h2>Registrar Notas</h2>

@using (Html.BeginForm("Create", "CalificacionWeb", FormMethod.Post))
{
    @Html.AntiForgeryToken()
    @Html.HiddenFor(model => model.Estudiante.Id)

    <table class="table">
        <thead>
            <tr>
                <th>Materia</th>
                <th>Parcial</th>
                <th>Nota Cuantitativa</th>
                <th>Nota Cualitativa</th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.Calificaciones.Count; i++)
            {
                var materiaNombre = Model.Materias.FirstOrDefault(m => m.Id == Model.Calificaciones[i].MateriaId)?.Nombre ?? "Materia no encontrada";

                <tr>
                    <td>
                        @Html.HiddenFor(m => Model.Calificaciones[i].MateriaId)
                        @materiaNombre
                    </td>
                    <td>
                        @Html.HiddenFor(m => Model.Calificaciones[i].ParcialId, new { Value = "2" }) <!-- Cambia "2" por el Id correspondiente de Parcial I -->
                        <span class="form-control" style="border: none; background: transparent;">Parcial I</span>
                    </td>
                    <td>
                        @Html.TextBoxFor(m => Model.Calificaciones[i].NCuantitativa, new { @class = "form-control", type = "number", step = "0.01", min = "0", max = "100", oninput = "updateCualitativa(this, " + i + ")" })
                    </td>
                    <td>
                        @Html.TextBoxFor(m => Model.Calificaciones[i].NCualitativa, new { @class = "form-control", @readonly = "readonly" })
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <button type="submit" class="btn btn-primary">Guardar Notas</button>
}

<script>
    function updateCualitativa(input, index) {
        var cuantitativa = parseFloat(input.value);
        var cualitativa = "";

        if (cuantitativa >= 0 && cuantitativa <= 59) {
            cualitativa = "AI";
        } else if (cuantitativa >= 60 && cuantitativa <= 75) {
            cualitativa = "AF";
        } else if (cuantitativa >= 76 && cuantitativa <= 89) {
            cualitativa = "AS";
        } else if (cuantitativa >= 90 && cuantitativa <= 100) {
            cualitativa = "AA";
        }

        document.getElementsByName("Calificaciones[" + index + "].NCualitativa")[0].value = cualitativa;
    }
</script>
